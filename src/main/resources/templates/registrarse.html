<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro | Nextclass</title>
    <link th:include="components/link"></link>
    <link rel="stylesheet" type="text/css" href="/css/registrarse.css">
    <script>
        function validarDNI(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            if (input.value.length > 8) {
                input.value = input.value.slice(0, 8);
            }
        }

        function validarContrasenas() {
            const password = document.getElementById('reg-nueva-clave').value;
            const confirmPassword = document.getElementById('reg-repetir-clave').value;
            const mensajeError = document.getElementById('reg-mensaje-error');
            const submitBtn = document.getElementById('reg-submit');

            if (password !== confirmPassword) {
                mensajeError.style.display = 'block';
                mensajeError.textContent = 'Las contraseñas no coinciden';
                submitBtn.disabled = true;
                setTimeout(() => {
                    mensajeError.style.display = 'none';
                    submitBtn.disabled = false;
                }, 2000);
                return false;
            }
            return true;
        }

        function validarEnTiempoReal() {
            const password = document.getElementById('reg-nueva-clave');
            const confirmPassword = document.getElementById('reg-repetir-clave');
            
            password.addEventListener('input', validarContrasenas);
            confirmPassword.addEventListener('input', validarContrasenas);
        }

        window.onload = validarEnTiempoReal;
    </script>
</head>
<body>
    <div th:replace="components/mensajes :: mostrarMensaje(${error})" class="custom-alert"></div>

    <main class="reg-main">
        <section class="reg-container">
            <form action="/registrarse" method="POST" class="reg-form" id="FormRegistro" autocomplete="off" onsubmit="return verificarExistenciaYRegistrar(event)">
                <h1 class="reg-title league-spartan">¡Registra tu cuenta!</h1>
                <hr>
                <p class="reg-subtitle league-spartan">Ingresa tus datos para registrarte</p>
                
                <div class="reg-grid ">
                    <div class="reg-input-box cabin">
                        <label for="reg-nombre">Nombre:</label>
                        <input type="text" id="reg-nombre" name="nombre" class="reg-input" placeholder="Tu nombre" required />
                    </div>
                    <div class="reg-input-box cabin">
                        <label for="reg-apellidos">Apellidos:</label>
                        <input type="text" id="reg-apellidos" name="apellido" class="reg-input" placeholder="Tus apellidos" required />
                    </div>
                    <div class="reg-input-box cabin">
                        <label for="reg-correo">Correo electrónico:</label>
                        <input type="email" id="reg-correo" name="correo" class="reg-input" placeholder="Tu correo electrónico" required />
                    </div>
                    <div class="reg-input-box">
                        <label for="reg-usuario">Nombre de usuario:</label>
                        <input type="text" id="reg-usuario" name="usuario" class="reg-input" placeholder="Tu nombre de usuario" required />
                    </div>
                    <div class="reg-input-box cabin">
                        <label for="reg-dni">DNI:</label>
                        <input type="text" id="reg-dni" name="dni" class="reg-input" placeholder="Tu DNI" maxlength="8" oninput="validarDNI(this)" required />
                    </div>
                    <div class="reg-input-box cabin">
                        <label for="reg-nueva-clave">Contraseña:</label>
                        <input type="password" id="reg-nueva-clave" name="contrasena" class="reg-input" placeholder="Contraseña nueva" required />
                    </div>
                    <div class="reg-input-box cabin">
                        <label for="reg-repetir-clave">Repetir contraseña:</label>
                        <input type="password" id="reg-repetir-clave" name="repetircontrasena" class="reg-input" placeholder="Repite la contraseña" required />
                        <div id="reg-mensaje-error" class="reg-error-msg"></div>
                    </div>
                </div>

                <div class="reg-footer">
                    <a th:href="@{/login}" class="reg-link">¿Ya tienes cuenta?</a>
                </div>

                <input type="submit" value="Registrarse" class="btn-reg-submit" name="registro" id="reg-submit">
            </form>
        </section>
    </main>

    <script>
        setTimeout(function() {
            const mensajeContainer = document.querySelector('.mensaje-container');
            if (mensajeContainer) {
                mensajeContainer.style.display = 'none';
            }
        }, 3000);

        function validarNombreApellido(input) {
            const regex = /^[A-Za-záéíóúÁÉÍÓÚñÑ\s]+$/;
            if (!regex.test(input.value)) {
                alert("El nombre o apellido solo puede contener letras y espacios.");
                input.value = "";
                input.focus();
            }
        }

        function verificarDatos(event) {
            const nombre = document.getElementById('reg-nombre');
            const apellidos = document.getElementById('reg-apellidos');

            validarNombreApellido(nombre);
            validarNombreApellido(apellidos);

            if (!nombre.value || !apellidos.value) {
                event.preventDefault();
                return false;
            }
        }

        window.onload = function() {
            document.getElementById('reg-nombre').addEventListener('input', function() {
                validarNombreApellido(this);
            });
            document.getElementById('reg-apellidos').addEventListener('input', function() {
                validarNombreApellido(this);
            });
            document.getElementById('FormRegistro').addEventListener('submit', verificarDatos);
        };
    </script>
</body>
</html>
