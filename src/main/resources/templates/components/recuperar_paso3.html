<form th:action="@{/recuperar/cambiarContrasena}" method="post" class="form-recuperar" onsubmit="return validarContrasenas()">
    <h2 class="league-spartan">Restablecer contraseña</h2>
    <p class="league-spartan">Ingresa tu nueva contraseña y confírmala para continuar.</p>

    <!-- Nueva contraseña -->
    <div class="password-container cabin">
        <label for="nuevaContrasena" class="cabin">Nueva contraseña</label>
        <div class="input-wrapper">
            <input type="password" class="league-spartan" id="nuevaContrasena" name="nuevaContrasena" placeholder="********" required>
            <button type="button" class="toggle-password" onclick="togglePassword('nuevaContrasena', this)">
                <!-- OJO CERRADO -->
                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px" fill="#444">
                    <path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Repetir contraseña -->
    <div class="password-container">
        <label for="repetirContrasena" class="cabin">Repetir contraseña</label>
        <div class="input-wrapper">
            <input type="password" class="league-spartan" id="repetirContrasena" name="repetirContrasena" placeholder="********" required>
            <button type="button" class="toggle-password" onclick="togglePassword('repetirContrasena', this)">
                <!-- OJO CERRADO -->
                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px" fill="#444">
                    <path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Z"/>
                </svg>
            </button>
        </div>
        <div id="mensaje-error" class="reg-error-msg"></div>
    </div>

    <button type="submit" class="btn-rec cabin">Cambiar contraseña</button>
</form>

<style>

.form-recuperar {
    max-width: 360px;
    margin: 50px auto;
    padding: 30px 25px;
    background: #fff;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 18px;
}

.form-recuperar h2 {
    text-align: center;
    color: #111827;
    margin-bottom: 0;
    font-size: 1.35rem;
}

.form-recuperar p {
    font-size: 0.9rem;
    color: #555;
    text-align: center;
    margin-bottom: 5px;
}

.password-container {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.form-recuperar label {
    font-weight: 600;
    color: #1f2937;
}

.form-recuperar input[type="password"],
.form-recuperar input[type="text"] {
    width: 100%;
    padding: 11px 42px 11px 12px;
    border: 1.5px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
    transition: border 0.3s, box-shadow 0.3s;
}

.form-recuperar input:focus {
    border-color: var(--color-secondary, #848ea3);
    box-shadow: 0 0 6px rgba(37,99,235,0.25);
    outline: none;
}

.toggle-password {
    position: absolute;
    right: 10px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

.toggle-password:hover svg {
    opacity: 0.85;
    transform: scale(1.05);
}

.reg-error-msg {
    color: #d32f2f;
    font-size: 0.85rem;
    display: none;
    margin-top: 4px;
}

.btn-rec {
    padding: 12px;
    background-color: var(--color-secondary, #848ea3);
    color: white;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
}

.btn-rec:hover {
    background-color: #848ea3;
    transform: translateY(-1px);
}
</style>

<script>
function togglePassword(id, btn) {
    const input = document.getElementById(id);
    const svg = btn.querySelector('svg');

    // SVG de ojo abierto
    const eyeOpen = `
        <path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29Zm0 200q-151 0-269-83.5T40-500q54-101 153-160.5T480-720q151 0 270 79.5T920-500q-54 101-153 160.5T480-200Z"/>`;
    
    // SVG de ojo cerrado
    const eyeClosed = `
        <path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Z"/>`;

    if (input.type === 'password') {
        input.type = 'text';
        svg.innerHTML = eyeOpen;
    } else {
        input.type = 'password';
        svg.innerHTML = eyeClosed;
    }
}

function validarContrasenas() {
    const pass1 = document.getElementById('nuevaContrasena').value;
    const pass2 = document.getElementById('repetirContrasena').value;
    const mensaje = document.getElementById('mensaje-error');

    if (pass1 !== pass2) {
        mensaje.style.display = 'block';
        mensaje.textContent = 'Las contraseñas no coinciden';
        return false;
    } else if (pass1.length < 6) {
        mensaje.style.display = 'block';
        mensaje.textContent = 'Debe tener al menos 6 caracteres';
        return false;
    } else {
        mensaje.style.display = 'none';
        return true;
    }
}

document.getElementById('nuevaContrasena').addEventListener('input', validarContrasenas);
document.getElementById('repetirContrasena').addEventListener('input', validarContrasenas);
</script>
